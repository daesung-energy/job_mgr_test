{% extends 'jobs/base.html' %}
{% load static %}
{% block content %}

<body>
    <wrap>
        <div id="JB200" style="padding-left: 50px; margin-top:50px;">
            <div style="display: flex;">
                <!-- 회기 선택 div -->
                <div id = "JB200" style="white-space: nowrap;">
                    <!-- 회기 선택 form -->
                    <form method="POST" id="prd_select" action="{% url 'JB200' %}">
                    {% csrf_token %}
                    <!-- 회기 표시 박스-->
                    <div class="list-box-prd">
                        <table>
                        <thead>
                            <tr>
                            <th style="width: 100px;">
                                <p>회 기</p>
                            </th>
                            <th>                           
                                <select name="prd_selected" class="select-combox3" id="selectOptions" onchange="this.form.submit()">
                                    {% for item in prd_list %}
                                    <option value="{{ item.prd_cd }}" {%if prd_selected == item.prd_cd %} selected {% endif %}>
                                        {{ item.prd_cd }} ({{ item.year }}년 {{ item.turn }}차수) - 확정여부 : {{ item.prd_done_yn }} </option>
                                    {% endfor %}
                                </select>
                            </th>
                            </tr>
                        </thead>
                        </table>
                    </div>
                    </form>
                </div>
                
                <div style="padding-top:20px; padding-left:30px; white-space: nowrap;">
                    <!-- 팀 선택하는 폼, 이 값에 따라서 직무 목록이 바뀐다. -->
                    <form action = "{% url 'JB200_1' %}" method="POST" id="JB200_2">
                        {% csrf_token %}
                        <input type="hidden" name="prd_selected" value="{{ prd_selected }}">
                        <p class="label-text2"> 부서
                            <select name="dept_cd_selected" class="select-combox" onchange="this.form.submit()">
                                {% for item in dept_list %}
                                    <option value={{ item.dept_cd }} {%if dept_cd_selected == item.dept_cd %} selected {% endif %}> {{ item.dept_nm }} </option>
                                {% endfor %}
                            </select>
                        </p>
                    </form>
                </div>
            </div>

            <div style="padding-top: 20px; padding-left: 20px;">

                <div style="display: flex;">
                    <div id="job">
                        <p style="font-family: Seed-Medium;"><span>직무</span></p>
                        <div id="jobDiv" style="padding-left: 10px; padding-top:10px; border: 1px solid #ccc; overflow-y: scroll;
                        height:180px; width:400px; flex-wrap: wrap; margin-top:5px;">
                        <!-- 여기에 직무 목록이 동적으로 생성 -->
                        </div>
                    </div>
                    
                    <!-- 책무 Div -->
                    <div id="duty" style="padding-left:20px;">
                        <p style="font-family: Seed-Medium;"><span>책무</span></p>
                        <div id="dutyDiv" style="padding-left: 10px; padding-top:10px; border: 1px solid #ccc; overflow-y: scroll;
                        height:180px; width:400px; flex-wrap: wrap; margin-top:5px;">
                        <!-- 선택된 직무에 따라 책무 목록이 동적으로 생성 -->
                        </div>
                    </div>
                    <!-- 부서 업무량, 적정 인원 표시 div -->
                    <div id="analysis_cal" style="padding-left:50px; padding-top:80px; display: flex;">
                        <div>
                        <p style="font-family: Seed-Medium;"><span>부서 업무량</span></p>
                        <p style="font-family: Seed-Medium;"><span>적정 인원</span></p>
                        </div>
                        <div class="analysis_table" style="padding-left:5px;">
                            <table>
                                <tr>
                                    <td><input id="sum_prfrm_tm_ann_cal" name="sum_prfrm_tm_ann_cal" value="{{ sum_prfrm_tm_ann_cal }}" readonly></td>
                                </tr>
                                <tr>
                                    <td><input id="po_right" name="po_right" value="{{ po_right }}" readonly></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <!-- 환산 부서 업무량과 조정 업무량 / 적정 인원 차이를 표시하는 div -->
                    <div id="analysis_adj" style="padding-left:20px; padding-top:80px; display: flex;">
                        <div>
                            <p style="font-family: Seed-Medium;"><span>업무량 차이</span></p>
                            <p style="font-family: Seed-Medium;"><span>적정 인원 차이</span></p>
                        </div>
                        <div class="analysis_table" style="padding-left:5px;">
                            <table>
                                <tr>
                                    <td><input id="prfrm_tm_diff" name="prfrm_tm_diff" readonly></td>
                                </tr>
                                <tr>
                                    <td><input id="po_right_diff" name="po_right_diff" readonly></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <!-- 업무량 조정, 조정 적정 인원 표시 div -->
                    <div id="analysis_adj" style="padding-left:20px; padding-top:80px; display: flex;">
                        <input type="hidden" name="std_wrk_tm" value={{ std_wrk_tm }}>
                        <div>
                            <p style="font-family: Seed-Medium;"><span>업무량 조정</span></p>
                            <p style="font-family: Seed-Medium;"><span>적정 인원</span></p>
                        </div>
                        <div class="analysis_table" style="padding-left:5px;">
                            <table>
                                <tr>
                                    <td><input id="sum_prfrm_tm_ann_cal_adj" name="sum_prfrm_tm_ann_cal_adj" value="{{ sum_prfrm_tm_ann_cal_adj }}" readonly></td>
                                </tr>
                                <tr>
                                    <td><input id="po_right_adj" name="po_right_adj" value="{{ po_right_adj }}" readonly></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- 과업 Div -->
                <p style="font-family: Seed-Medium; margin-top: 10px; font-size: 14px;"><span>과업</span><span style="margin-left:205px;">중요도</span>
                    <span style="margin-left:35px;">난이도</span><span style="margin-left:40px;">숙련도</span><span style="margin-left:35px;">업무수준</span>
                    <span style="margin-left:20px;">업무등급</span><span style="margin-left:35px;">연간 업무량</span><span style="margin-left:30px;">환산 업무량</span>
                    <span style="margin-left:15px;">|(조정)</span>
                    <span style="margin-left:1px;">중요도</span><span style="margin-left:40px;">난이도</span><span style="margin-left:40px;">숙련도</span>
                    <span style="margin-left:30px;">업무수준</span><span style="margin-left:25px;">업무등급</span><span style="margin-left:30px;">연간 업무량</span>
                    <span style="margin-left:30px;">환산 업무량</span></p>
                <div id="task" style="padding-left: 10px; padding-top:10px; border: 1px solid #ccc; overflow-y: scroll;
                height:400px; width:1500px; flex-wrap: wrap; margin-top:5px;">
                    <div id="taskDiv">
                        <!-- 선택된 직무와 책무에 따라 과업 목록이 동적으로 생성 -->
                    </div>
                </div>
            </div>

            <div style="padding-top:20px; padding-left:600px;">
                <form action="{% url 'JB200_2' %}" method="POST" id="dataForm">
                    {% csrf_token %}
                    <input type="hidden" name="jsonData" id="jsonData" value="">
                    <input type="hidden" name="prd_selected" value={{ prd_selected }}>
                    <input type="hidden" name="dept_cd_selected" value={{ dept_cd_selected }}>
                    {% if prd_done == 'Y' %}
                        <button class="del_disabled" disabled>저장</button>
                        <button class="del_disabled" disabled>취소</button>
                        {% else %}
                        <button type="submit" class="save" name="action" value="action1" id="saveButton">저장</button>
                        <button type="submit" class="cancel" name="action" value="action2" id="cancelButton">취소</button>
                    {% endif %}
                </form>
            </div>

        </div>

        <!-- 메시지 표시 -->
        {% if messages %}
        <div id="messages" style="display: none;">
            {% for message in messages %}
            <span class="{{ message.tags }}">{{ message|escapejs }}</span>
            {% endfor %}
        </div>
        {% endif %}
    </wrap>

    <script>
        var messagesContainer = document.getElementById('messages');
        if (messagesContainer) {
            var messages = messagesContainer.getElementsByTagName('span');
            for (var i = 0; i < messages.length; i++) {
            alert(messages[i].textContent);
            }
        } 

        document.addEventListener("DOMContentLoaded", function() { // DOM이 로드되면 실행되는 함수
        
            var jsonData = JSON.parse('{{ data|escapejs|safe }}'); // JSON 데이터 파싱
            var jsonData2 = JSON.parse('{{ standard|escapejs|safe }}'); // JSON 데이터 파싱

            function createJobList() { // 직무 목록을 생성하는 함수

                jsonData.sort((a, b) => a.job_seq - b.job_seq); //  직무 순서대로 정렬
                var jobs = [...new Set(jsonData.map(data => data.job_cd))]; // 중복 제거
                var jobDiv = document.getElementById('jobDiv'); // 직무 목록을 담을 div 요소 찾기

                jobs.forEach(jobCd => { // 직무 목록을 동적으로 생성

                    const jobData = jsonData.find(data => data.job_cd === jobCd);
                    const jobName = jobData ? jobData.job_nm : ''; // 직무명 가져오기, 없으면 빈 문자열 처리

                    const container = document.createElement('div'); // 책무와 버튼을 담을 컨테이너

                    const radioInput = document.createElement('input'); // 라디오 버튼 생성
                    radioInput.setAttribute('type', 'radio'); 
                    radioInput.setAttribute('name', 'job'); // 라디오 버튼의 name을 'job'으로 설정
                    radioInput.setAttribute('value', jobCd); // 직무 코드를 value로 설정
                    container.appendChild(radioInput); // 라디오 버튼을 컨테이너에 추가

                    const jobNameInput = document.createElement('input'); // 직무명 입력 상자 생성
                    jobNameInput.setAttribute('type', 'text');
                    jobNameInput.setAttribute('readonly', 'readonly'); // 읽기 전용으로 설정
                    jobNameInput.setAttribute('value', jobName); // 직무명 설정
                    jobNameInput.setAttribute('class', 'input_text_duty_nm');
                    container.appendChild(jobNameInput); // 직무명 입력 상자를 컨테이너에 추가
                    
                    jobDiv.appendChild(container); // 위의 컨테이너를 직무 목록 div에 추가

                    radioInput.addEventListener('change', function() { // 직무 목록 라디오 버튼 누르면(change) 책무 목록을 띄운다.
                        updateDutyList(this.value); // 선택된 직무에 따라 책무 목록을 업데이트하는 함수 호출
                        // 첫 번째 책무 선택하고 그에 해당하는 과업 리스트 띄우기
                        var firstDutyRadio = dutyDiv.querySelector('input[name="duty"]');
                        if (firstDutyRadio) {
                            firstDutyRadio.checked = true;
                            updateTaskList(this.value, firstDutyRadio.value);
                        }
                    });
                });

                // 로컬 스토리지에서 직무 선택 값 로드
                var selectedJob = localStorage.getItem('selectedJob');
                if (selectedJob) {
                    var selectedJobRadio = jobDiv.querySelector(`input[name="job"][value="${selectedJob}"]`);
                    if (selectedJobRadio) {
                        selectedJobRadio.checked = true;
                        updateDutyList(selectedJob);
                    }
                } else if (jobs.length > 0) {
                    var firstJobRadio = jobDiv.querySelector('input[name="job"]');
                    if (firstJobRadio) {
                        firstJobRadio.checked = true;
                        updateDutyList(firstJobRadio.value);
                    }
                }

                // 환산 업무량과 적정 인원 차이 계산
                calculateDifferences();
            }

            function updateDutyList(selectedJob) { // 선택한 직무에 따라 책무 목록을 업데이트하는 함수
            
                var duties = jsonData.filter(data => data.job_cd === selectedJob) // 선택된 직무에 해당하는 책무만 필터링
                                .sort((a, b) => a.duty_seq - b.duty_seq) // 책무 순서대로 정렬
                                .map(data => data.duty_nm); // 책무명만 추출
                
                duties = [...new Set(duties)]; // 중복 제거

                var dutyDiv = document.getElementById('dutyDiv'); // 책무 목록을 담을 div 요소 찾기
                dutyDiv.innerHTML = ''; // 이전 내용을 지우고 제목을 다시 추가
                
                // duties.forEach((duty, index) => { // 책무명을 이용하여 책무 목록을 동적으로 생성. duty는 duties 배열의 각 요소이다.
                duties.forEach(duty => {
                    
                    const container = document.createElement('div'); // 책무와 버튼을 담을 컨테이너

                    // var prd_done = document.querySelector('input[name="prd_done"]').value;

                    const radioInput = document.createElement('input');
                    radioInput.setAttribute('type', 'radio'); // 라디오 버튼 생성
                    radioInput.setAttribute('name', 'duty'); // 라디오 버튼의 name을 'duty'로 설정
                    radioInput.setAttribute('value', duty); // 책무명을 value로 설정
                    
                    const inputText = document.createElement('input');
                    inputText.setAttribute('type', 'text'); // 입력 필드 생성
                    inputText.setAttribute('name', 'duty_nm'); // inputText의 name을 'duty_nm'으로 설정
                    inputText.setAttribute('class', 'input_text_duty_nm');
                    inputText.setAttribute('value', duty); // 책무명을 value로 설정
                    inputText.setAttribute('readonly', 'readonly');
                    
                    container.appendChild(radioInput); // 라디오 버튼을 컨테이너에 추가
                    container.appendChild(inputText); // 입력 필드를 컨테이너에 추가
                   
                    dutyDiv.appendChild(container); // 컨테이너를 책무 목록 div에 추가

                    radioInput.addEventListener('change', function() { // 책무 라디오 선택 시 과업 목록 띄움
                        updateTaskList(selectedJob, this.value); // 선택된 책무에 따라 과업 목록을 업데이트하는 함수 호출
                    });
                    
                });

                // 로컬 스토리지에서 책무 선택 값 로드
                var selectedDuty = localStorage.getItem('selectedDuty');
                if (selectedDuty) {
                    var selectedDutyRadio = dutyDiv.querySelector(`input[name="duty"][value="${selectedDuty}"]`);
                    if (selectedDutyRadio) {
                        selectedDutyRadio.checked = true;
                        updateTaskList(selectedJob, selectedDuty);
                    }
                } else if (duties.length > 0) {
                    var firstDutyRadio = dutyDiv.querySelector('input[name="duty"]');
                    if (firstDutyRadio) {
                        firstDutyRadio.checked = true;
                        updateTaskList(selectedJob, firstDutyRadio.value);
                    }
                }

                dutyDiv.style.display = 'block'; // 책무 div의 display 속성을 block으로 변경하여 표시
            } // 책무 목록 업데이트 함수 끝

            function updateTaskList(selectedJob, selectedDuty) { // 과업 목록을 업데이트하는 함수

            // 선택된 직무와 책무에 해당하는 과업만 필터링하여 과업 순서대로 정렬하여 tasks에 저장
            var tasks = jsonData.filter(data => data.duty_nm === selectedDuty && data.job_cd === selectedJob).sort((a, b) => a.task_seq - b.task_seq);

            var taskDiv = document.getElementById('taskDiv'); // 과업 목록을 담을 div 요소 찾기

            taskDiv.innerHTML = ''; // 이전 내용을 지우고 제목을 다시 추가

            tasks.forEach(taskData => { // 과업 목록을 동적으로 생성, taskData는 tasks 배열의 각 요소이다.

                const container = document.createElement('div'); // 과업과 버튼을 담을 컨테이너
                container.classList.add('task-container'); // 스타일을 위한 클래스 추가

                const inputText = document.createElement('input'); // 입력 필드 생성
                inputText.setAttribute('type', 'text');
                inputText.setAttribute('name', 'task_nm'); // inputText의 name을 'task_nm'으로 설정
                inputText.setAttribute('class', 'input_text_task_nm')
                inputText.setAttribute('value', taskData.task_nm); // 과업명을 value로 설정     
                inputText.setAttribute('readonly', 'readonly'); // 읽기 전용으로 설정
                inputText.setAttribute('style', 'width: 200px;'); // 너비 설정    

                const inputText2 = document.createElement('input'); // 중요도 입력 필드 생성
                inputText2.setAttribute('type', 'text');
                inputText2.setAttribute('name', 'work_lv_imprt');
                inputText2.setAttribute('class', 'input_text_num');
                inputText2.setAttribute('readonly', true);
                if (selectedJob === 'JC001') {
                    inputText2.setAttribute('value', '');
                } else {
                    inputText2.setAttribute('value', taskData.work_lv_imprt);
                }
                // backgroundcolor 회색
                inputText2.style.backgroundColor = '#f0f0f0';
                

                const inputText3 = document.createElement('input'); // 난이도 입력 필드 생성
                inputText3.setAttribute('type', 'text');
                inputText3.setAttribute('name', 'work_lv_dfclt');
                inputText3.setAttribute('class', 'input_text_num');
                // taskData의 jobCd가 JC001이면 빈 문자열로 설정
                if (selectedJob === 'JC001') {
                    inputText3.setAttribute('value', '');
                } else {
                    inputText3.setAttribute('value', taskData.work_lv_dfclt);
                }
                inputText3.setAttribute('readonly', true);
                inputText3.style.backgroundColor = '#f0f0f0';

                const inputText4 = document.createElement('input'); // 숙련도 입력 필드 생성
                inputText4.setAttribute('type', 'text');
                inputText4.setAttribute('name', 'work_lv_prfcn');
                inputText4.setAttribute('class', 'input_text_num');
                if (selectedJob === 'JC001') {
                    inputText4.setAttribute('value', '');
                } else {
                    inputText4.setAttribute('value', taskData.work_lv_prfcn);
                }
                inputText4.setAttribute('readonly', true);
                inputText4.style.backgroundColor = '#f0f0f0';

                const inputText5 = document.createElement('input'); // 업무수준 입력 필드 생성
                inputText5.setAttribute('type', 'text');
                inputText5.setAttribute('name', 'work_lv_sum');
                inputText5.setAttribute('class', 'input_text_num');
                if (selectedJob === 'JC001') {
                    inputText5.setAttribute('value', '');
                } else {
                    inputText5.setAttribute('value', taskData.work_lv_sum);
                }
                inputText5.setAttribute('readonly', true);
                inputText5.style.backgroundColor = '#f0f0f0';

                const inputText6 = document.createElement('input'); // 업무등급 입력 필드 생성
                inputText6.setAttribute('type', 'text');
                inputText6.setAttribute('name', 'work_grade');
                inputText6.setAttribute('class', 'input_text_num');
                if (selectedJob === 'JC001') {
                    inputText6.setAttribute('value', '');
                } else {
                    inputText6.setAttribute('value', taskData.work_grade);
                }
                inputText6.setAttribute('readonly', true);
                inputText6.style.backgroundColor = '#f0f0f0';

                const inputText7 = document.createElement('input'); // 연간 수행시간 입력 필드 생성
                inputText7.setAttribute('type', 'text');
                inputText7.setAttribute('name', 'prfrm_tm_ann');
                inputText7.setAttribute('class', 'input_text_num2');
                if (selectedJob === 'JC001') {
                    inputText7.setAttribute('value', '');
                } else {
                    inputText7.setAttribute('value', parseFloat(taskData.prfrm_tm_ann).toFixed(1));
                }
                inputText7.setAttribute('readonly', true);
                inputText7.style.backgroundColor = '#f0f0f0';

                const inputTex15 = document.createElement('input'); // 가중치 적용시간 입력 필드 생성
                inputTex15.setAttribute('type', 'text');
                inputTex15.setAttribute('name', 'prfrm_tm_ann_cal');
                inputTex15.setAttribute('class', 'input_text_num2');
                if (selectedJob === 'JC001') {
                    inputTex15.setAttribute('value', '');
                } else {
                    inputTex15.setAttribute('value', parseFloat(taskData.prfrm_tm_ann_cal).toFixed(1));
                }
                inputTex15.setAttribute('readonly', true);
                inputTex15.style.backgroundColor = '#f0f0f0';

                const inputText16 = document.createElement('input'); // 조정 여부 입력 필드 생성
                inputText16.setAttribute('type', 'text');
                inputText16.setAttribute('name', 'adj_yn');
                inputText16.setAttribute('class', 'input_text_num');
                // taskData의 adj_yn 값이 1이면 *로 표시하고, 0이면 빈 문자열로 설정
                if (taskData.adj_yn === 1) {
                    inputText16.setAttribute('value', '*');
                } else {
                    inputText16.setAttribute('value', '');
                }
                inputText16.setAttribute('readonly', true);
                inputText16.style.backgroundColor = '#f0f0f0';
                inputText16.style.width = '20px';

                const inputText8 = document.createElement('input'); // 중요도 조정 입력 필드 생성
                inputText8.setAttribute('type', 'text');
                inputText8.setAttribute('name', 'work_lv_imprt_adj');
                if (selectedJob === 'JC001') {
                    inputText8.setAttribute('value', '');
                } else {
                    inputText8.setAttribute('value', taskData.work_lv_imprt_adj);
                }
                inputText8.setAttribute('class', 'input_text_num');
                // inputText8.style.marginLeft = '30px';
                
                const inputText9 = document.createElement('input'); // 난이도 조정 입력 필드 생성
                inputText9.setAttribute('type', 'text');
                inputText9.setAttribute('name', 'work_lv_dfclt_adj');
                inputText9.setAttribute('class', 'input_text_num');
                if (selectedJob === 'JC001') {
                    inputText9.setAttribute('value', '');
                } else {
                    inputText9.setAttribute('value', taskData.work_lv_dfclt_adj);
                }
               
                const inputText10 = document.createElement('input'); // 숙련도 조정 입력 필드 생성
                inputText10.setAttribute('type', 'text');
                inputText10.setAttribute('name', 'work_lv_prfcn_adj');
                inputText10.setAttribute('class', 'input_text_num');
                if (selectedJob === 'JC001') {
                    inputText10.setAttribute('value', '');
                } else {
                    inputText10.setAttribute('value', taskData.work_lv_prfcn_adj);
                }
                
                const inputText11 = document.createElement('input'); // 업무수준 조정 입력 필드 생성
                inputText11.setAttribute('type', 'text');
                inputText11.setAttribute('name', 'work_lv_sum_adj');
                inputText11.setAttribute('class', 'input_text_num');
                if (selectedJob === 'JC001') {
                    inputText11.setAttribute('value', '');
                } else {
                    inputText11.setAttribute('value', taskData.work_lv_sum_adj);
                }
                inputText11.setAttribute('readonly', true);
                // backgroundcolor yellow
                inputText11.style.backgroundColor = '#f0f0f0';

                const inputText12 = document.createElement('input'); // 업무등급 조정 입력 필드 생성
                inputText12.setAttribute('type', 'text');
                inputText12.setAttribute('name', 'work_grade_adj');
                inputText12.setAttribute('class', 'input_text_num');
                if (selectedJob === 'JC001') {
                    inputText12.setAttribute('value', '');
                } else {
                    inputText12.setAttribute('value', taskData.work_grade_adj);
                }
                inputText12.setAttribute('readonly', true);
                // backgroundcolor yellow
                inputText12.style.backgroundColor = '#f0f0f0';

                const inputText13 = document.createElement('input'); // 연간 수행시간 조정 입력 필드 생성
                inputText13.setAttribute('type', 'text');
                inputText13.setAttribute('name', 'prfrm_tm_ann_adj');
                inputText13.setAttribute('class', 'input_text_num2');
                if (selectedJob === 'JC001') {
                    inputText13.setAttribute('value', '');
                } else {
                    inputText13.setAttribute('value', parseFloat(taskData.prfrm_tm_ann_adj).toFixed(1));
                }

                const inputText14 = document.createElement('input'); // 가중치 적용시간 입력 필드 생성
                inputText14.setAttribute('type', 'text');
                inputText14.setAttribute('name', 'prfrm_tm_ann_cal_adj');
                inputText14.setAttribute('class', 'input_text_num2');
                if (selectedJob === 'JC001') {
                    inputText14.setAttribute('value', '');
                } else {
                    inputText14.setAttribute('value', parseFloat(taskData.prfrm_tm_ann_cal_adj).toFixed(1));
                }
                inputText14.setAttribute('readonly', true);
                inputText14.style.backgroundColor = '#f0f0f0';

                // job_cd가 JC001이면 inputText8, 9, 10, 13 readonly
                if (selectedJob === 'JC001') {
                    inputText8.setAttribute('readonly', true);
                    inputText9.setAttribute('readonly', true);
                    inputText10.setAttribute('readonly', true);
                    inputText13.setAttribute('readonly', true);
                }
                
                // span 태그 생성하고 안에 text는 |
                const span = document.createElement('span');
                span.textContent = '|';
                span.style.marginLeft = '5px';

                container.appendChild(inputText);
                container.appendChild(inputText2);
                container.appendChild(inputText3);
                container.appendChild(inputText4);
                container.appendChild(inputText5);
                container.appendChild(inputText6);
                container.appendChild(inputText7);
                container.appendChild(inputTex15);
                container.appendChild(span);
                container.appendChild(inputText16);
                container.appendChild(inputText8);
                container.appendChild(inputText9);
                container.appendChild(inputText10);
                container.appendChild(inputText11);
                container.appendChild(inputText12);
                container.appendChild(inputText13);
                container.appendChild(inputText14);

                // 각 input 필드에 대해 이벤트 리스너 추가
                inputText8.addEventListener('change', function() {
                    updateWorkLvImprtAdj(container, this.value); // 중요도 조정 값 업데이트
                    updateWorkLvSumAndGradeAdj(container); // 업무수준과 업무등급 업데이트
                    updatePrfrmTmAnnCalAdj(container, inputText13.value); // 연간 업무량과 환산 업무량 조정 값 업데이트
                    calculateAndDisplayValue(); // 전체 업무량과 적정 인원 업데이트
                    calculateDifferences(); // 업무량과 적정인원 차이 계산
                });

                inputText9.addEventListener('change', function() {
                    updateWorkLvDfcltAdj(container, this.value); // 난이도 조정 값 업데이트
                    updateWorkLvSumAndGradeAdj(container); // 업무수준과 업무등급 업데이트
                    updatePrfrmTmAnnCalAdj(container, inputText13.value); // 연간 업무량과 환산 업무량 조정 값 업데이트
                    calculateAndDisplayValue(); // 전체 업무량과 적정 인원 업데이트
                    calculateDifferences(); // 업무량과 적정인원 차이 계산
                });

                inputText10.addEventListener('change', function() {
                    updateWorkLvPrfcnAdj(container, this.value); // 숙련도 조정 값 업데이트
                    updateWorkLvSumAndGradeAdj(container); // 업무수준과 업무등급 업데이트
                    updatePrfrmTmAnnCalAdj(container, inputText13.value); // 연간 업무량과 환산 업무량 조정 값 업데이트
                    calculateAndDisplayValue(); // 전체 업무량과 적정 인원 업데이트
                    calculateDifferences(); // 업무량과 적정인원 차이 계산
                });

                inputText13.addEventListener('change', function() {
                    updatePrfrmTmAnnCalAdj(container, this.value); // 연간 업무량과 환산 업무량 조정 값 업데이트
                    calculateAndDisplayValue(); // 전체 업무량과 적정 인원 업데이트
                    calculateDifferences(); // 업무량과 적정인원 차이 계산
                });

                taskDiv.appendChild(container); // 과업 Div에 추가
                
                });
                // 함수 정의
                // function updateWorkLvImprtAdj(container, value) {
                // if (validateInput(value)) { // 입력값이 유효한지 확인
                //     const taskName = container.querySelector('input[name="task_nm"]').value;
                //     const taskIndex = jsonData.findIndex(task => task.task_nm === taskName && task.job_cd === selectedJob && task.duty_nm === selectedDuty);
                    
                //     if (taskIndex !== -1) {
                //         jsonData[taskIndex]['work_lv_imprt_adj'] = value;
                //     }

                //     // 디버깅: 각 값들을 콘솔에 출력
                //     console.log('work_lv_imprt_adj:', jsonData[taskIndex]['work_lv_imprt_adj']);
                //     console.log('work_lv_imprt:', jsonData[taskIndex]['work_lv_imprt']);
                //     console.log('work_lv_dfclt_adj:', jsonData[taskIndex]['work_lv_dfclt_adj']);
                //     console.log('work_lv_dfclt:', jsonData[taskIndex]['work_lv_dfclt']);
                //     console.log('work_lv_prfcn_adj:', jsonData[taskIndex]['work_lv_prfcn_adj']);
                //     console.log('work_lv_prfcn:', jsonData[taskIndex]['work_lv_prfcn']);
                //     console.log('prfrm_tm_ann_adj:', jsonData[taskIndex]['prfrm_tm_ann_adj']);
                //     console.log('prfrm_tm_ann:', jsonData[taskIndex]['prfrm_tm_ann']);

                //     // 그 index의 조정 중요도, 조정 난이도, 조정 숙련도, 조정 연간 업무량, 조정 환산 업무량이 각각 중요도, 난이도, 숙련도, 연간 업무량, 환산 업무량과 다른 경우
                //     // adj_yn을 *로 업데이트
                //     if (jsonData[taskIndex]['work_lv_imprt_adj'] !== jsonData[taskIndex]['work_lv_imprt'] 
                //     // || 
                //     //     jsonData[taskIndex]['work_lv_dfclt_adj'] !== jsonData[taskIndex]['work_lv_dfclt'] ||
                //     //     jsonData[taskIndex]['work_lv_prfcn_adj'] !== jsonData[taskIndex]['work_lv_prfcn'] 
                        
                //         // jsonData[taskIndex]['prfrm_tm_ann_adj'] !== jsonData[taskIndex]['prfrm_tm_ann']
                //         // prfrm_tm_ann_adj와 prfrm_tm_ann의 자료형을 float으로 바꾸어 비교. 무조건 소숫점 첫째자리까지 표현
                //         // parseFloat(jsonData[taskIndex]['prfrm_tm_ann_adj']).toFixed(1) !== parseFloat(jsonData[taskIndex]['prfrm_tm_ann']).toFixed(1)
                        
                //         ) {
                //         console.log('연간 업무량:', parseFloat(jsonData[taskIndex]['prfrm_tm_ann']).toFixed(1));
                //         jsonData[taskIndex]['adj_yn'] = 1;
                //         console.log('다른 경우');
                //         // input에 표시
                //         container.querySelector('input[name="adj_yn"]').value = '*';
                //     } else { // 같은 경우
                //         console.log('같은 경우');
                //         jsonData[taskIndex]['adj_yn'] = 0;
                //         container.querySelector('input[name="adj_yn"]').value = '4';
                //     }

                    
                // } else { // 입력값이 유효하지 않으면
                //     revertInput(container, 'work_lv_imprt_adj'); // 입력값을 되돌림
                // }
                // }

                // function updateWorkLvImprtAdj(container, value) {
                //     if (validateInput(value)) { // 입력값이 유효한지 확인
                //         const taskName = container.querySelector('input[name="task_nm"]').value;
                //         const taskIndex = jsonData.findIndex(task => task.task_nm === taskName && task.job_cd === selectedJob && task.duty_nm === selectedDuty);
                        
                //         if (taskIndex !== -1) {
                //             jsonData[taskIndex]['work_lv_imprt_adj'] = value;
                //         }

                //         // 디버깅: 각 값들을 콘솔에 출력
                //         console.log('work_lv_imprt_adj:', jsonData[taskIndex]['work_lv_imprt_adj']);
                //         console.log('work_lv_imprt:', jsonData[taskIndex]['work_lv_imprt']);
                //         console.log('work_lv_dfclt_adj:', jsonData[taskIndex]['work_lv_dfclt_adj']);
                //         console.log('work_lv_dfclt:', jsonData[taskIndex]['work_lv_dfclt']);
                //         console.log('work_lv_prfcn_adj:', jsonData[taskIndex]['work_lv_prfcn_adj']);
                //         console.log('work_lv_prfcn:', jsonData[taskIndex]['work_lv_prfcn']);
                //         console.log('prfrm_tm_ann_adj:', jsonData[taskIndex]['prfrm_tm_ann_adj']);
                //         console.log('prfrm_tm_ann:', jsonData[taskIndex]['prfrm_tm_ann']);

                //         // 각 값을 숫자로 변환
                //         const imprtAdj = parseFloat(jsonData[taskIndex]['work_lv_imprt_adj']);
                //         const imprt = parseFloat(jsonData[taskIndex]['work_lv_imprt']);
                //         const dfcltAdj = parseFloat(jsonData[taskIndex]['work_lv_dfclt_adj']);
                //         const dfclt = parseFloat(jsonData[taskIndex]['work_lv_dfclt']);
                //         const prfcnAdj = parseFloat(jsonData[taskIndex]['work_lv_prfcn_adj']);
                //         const prfcn = parseFloat(jsonData[taskIndex]['work_lv_prfcn']);
                //         const prfrmAnnAdj = parseFloat(jsonData[taskIndex]['prfrm_tm_ann_adj']).toFixed(1);
                //         const prfrmAnn = parseFloat(jsonData[taskIndex]['prfrm_tm_ann']).toFixed(1);

                //         // 각 조건이 어떻게 비교되는지 로그 출력
                //         console.log('imprtAdj !== imprt:', imprtAdj !== imprt);
                //         console.log('dfcltAdj !== dfclt:', dfcltAdj !== dfclt);
                //         console.log('prfcnAdj !== prfcn:', prfcnAdj !== prfcn);
                //         console.log('prfrmAnnAdj !== prfrmAnn:', prfrmAnnAdj !== prfrmAnn);

                //         // 각 값들을 비교하여 adj_yn 설정
                //         if (imprtAdj !== imprt || dfcltAdj !== dfclt || prfcnAdj !== prfcn || prfrmAnnAdj !== prfrmAnn) {
                //             jsonData[taskIndex]['adj_yn'] = 1;
                //             console.log('다른 경우');
                //             // input에 표시
                //             container.querySelector('input[name="adj_yn"]').value = '*';
                //         } else { // 같은 경우
                //             console.log('같은 경우');
                //             jsonData[taskIndex]['adj_yn'] = 0;
                //             container.querySelector('input[name="adj_yn"]').value = '4';
                //         }
                //     } else { // 입력값이 유효하지 않으면
                //         revertInput(container, 'work_lv_imprt_adj'); // 입력값을 되돌림
                //     }
                // }

                function updateWorkLvImprtAdj(container, value) {
                    if (validateInput(value)) { // 입력값이 유효한지 확인
                        const taskName = container.querySelector('input[name="task_nm"]').value;
                        const taskIndex = jsonData.findIndex(task => task.task_nm === taskName && task.job_cd === selectedJob && task.duty_nm === selectedDuty);
                        
                        if (taskIndex !== -1) {
                            jsonData[taskIndex]['work_lv_imprt_adj'] = value;
                        }

                        // 각 값을 숫자로 변환
                        const imprtAdj = parseFloat(jsonData[taskIndex]['work_lv_imprt_adj']);
                        const imprt = parseFloat(jsonData[taskIndex]['work_lv_imprt']);
                        const dfcltAdj = parseFloat(jsonData[taskIndex]['work_lv_dfclt_adj']);
                        const dfclt = parseFloat(jsonData[taskIndex]['work_lv_dfclt']);
                        const prfcnAdj = parseFloat(jsonData[taskIndex]['work_lv_prfcn_adj']);
                        const prfcn = parseFloat(jsonData[taskIndex]['work_lv_prfcn']);
                        const prfrmAnnAdj = parseFloat(jsonData[taskIndex]['prfrm_tm_ann_adj']).toFixed(1);
                        const prfrmAnn = parseFloat(jsonData[taskIndex]['prfrm_tm_ann']).toFixed(1);

                        // 각 값들을 비교하여 adj_yn 설정
                        if (imprtAdj !== imprt || dfcltAdj !== dfclt || prfcnAdj !== prfcn || prfrmAnnAdj !== prfrmAnn) {
                            jsonData[taskIndex]['adj_yn'] = 1;
                            // input에 표시
                            container.querySelector('input[name="adj_yn"]').value = '*';
                        } else { // 같은 경우
                            jsonData[taskIndex]['adj_yn'] = 0;
                            container.querySelector('input[name="adj_yn"]').value = '';
                        }
                    } else { // 입력값이 유효하지 않으면
                        revertInput(container, 'work_lv_imprt_adj'); // 입력값을 되돌림
                    }
                }

                function updateWorkLvDfcltAdj(container, value) {
                if (validateInput(value)) {
                    const taskName = container.querySelector('input[name="task_nm"]').value;
                    const taskIndex = jsonData.findIndex(task => task.task_nm === taskName && task.job_cd === selectedJob && task.duty_nm === selectedDuty);
                    
                    if (taskIndex !== -1) {
                        jsonData[taskIndex]['work_lv_dfclt_adj'] = value;
                    }

                    // 각 값을 숫자로 변환
                    const imprtAdj = parseFloat(jsonData[taskIndex]['work_lv_imprt_adj']);
                    const imprt = parseFloat(jsonData[taskIndex]['work_lv_imprt']);
                    const dfcltAdj = parseFloat(jsonData[taskIndex]['work_lv_dfclt_adj']);
                    const dfclt = parseFloat(jsonData[taskIndex]['work_lv_dfclt']);
                    const prfcnAdj = parseFloat(jsonData[taskIndex]['work_lv_prfcn_adj']);
                    const prfcn = parseFloat(jsonData[taskIndex]['work_lv_prfcn']);
                    const prfrmAnnAdj = parseFloat(jsonData[taskIndex]['prfrm_tm_ann_adj']).toFixed(1);
                    const prfrmAnn = parseFloat(jsonData[taskIndex]['prfrm_tm_ann']).toFixed(1);

                    // 각 값들을 비교하여 adj_yn 설정
                    if (imprtAdj !== imprt || dfcltAdj !== dfclt || prfcnAdj !== prfcn || prfrmAnnAdj !== prfrmAnn) {
                        jsonData[taskIndex]['adj_yn'] = 1;
                        // input에 표시
                        container.querySelector('input[name="adj_yn"]').value = '*';
                    } else { // 같은 경우
                        jsonData[taskIndex]['adj_yn'] = 0;
                        container.querySelector('input[name="adj_yn"]').value = '';
                    }

                } else {
                    revertInput(container, 'work_lv_dfclt_adj');
                }
                } 

                function updateWorkLvPrfcnAdj(container, value) {
                if (validateInput(value)) {
                    const taskName = container.querySelector('input[name="task_nm"]').value;
                    const taskIndex = jsonData.findIndex(task => task.task_nm === taskName && task.job_cd === selectedJob && task.duty_nm === selectedDuty);
                    
                    if (taskIndex !== -1) {
                        jsonData[taskIndex]['work_lv_prfcn_adj'] = value;
                    }

                    // 각 값을 숫자로 변환
                    const imprtAdj = parseFloat(jsonData[taskIndex]['work_lv_imprt_adj']);
                    const imprt = parseFloat(jsonData[taskIndex]['work_lv_imprt']);
                    const dfcltAdj = parseFloat(jsonData[taskIndex]['work_lv_dfclt_adj']);
                    const dfclt = parseFloat(jsonData[taskIndex]['work_lv_dfclt']);
                    const prfcnAdj = parseFloat(jsonData[taskIndex]['work_lv_prfcn_adj']);
                    const prfcn = parseFloat(jsonData[taskIndex]['work_lv_prfcn']);
                    const prfrmAnnAdj = parseFloat(jsonData[taskIndex]['prfrm_tm_ann_adj']).toFixed(1);
                    const prfrmAnn = parseFloat(jsonData[taskIndex]['prfrm_tm_ann']).toFixed(1);

                    // 각 값들을 비교하여 adj_yn 설정
                    if (imprtAdj !== imprt || dfcltAdj !== dfclt || prfcnAdj !== prfcn || prfrmAnnAdj !== prfrmAnn) {
                        jsonData[taskIndex]['adj_yn'] = 1;
                        // input에 표시
                        container.querySelector('input[name="adj_yn"]').value = '*';
                    } else { // 같은 경우
                        jsonData[taskIndex]['adj_yn'] = 0;
                        container.querySelector('input[name="adj_yn"]').value = '';
                    }

                } else {
                    revertInput(container, 'work_lv_prfcn_adj');
                }
                }

                function updateWorkLvSumAndGradeAdj(container) { // 업무수준과 업무등급을 업데이트하는 함수
                    const imprt = parseInt(container.querySelector('input[name="work_lv_imprt_adj"]').value, 10) || 0; // 중요도. 뒤의 10은 10진수를 의미
                    const dfclt = parseInt(container.querySelector('input[name="work_lv_dfclt_adj"]').value, 10) || 0; // 난이도
                    const prfcn = parseInt(container.querySelector('input[name="work_lv_prfcn_adj"]').value, 10) || 0; // 숙련도
                    const sum = imprt + dfclt + prfcn;

                    container.querySelector('input[name="work_lv_sum_adj"]').value = sum; // 업무수준 업데이트. json이 아니라 화면에만 업데이트

                    const taskName = container.querySelector('input[name="task_nm"]').value; // 과업명을 받아옴
                    // 그 직무의 그 책무의 그 과업의 인덱스를 찾음
                    const taskIndex = jsonData.findIndex(task => task.task_nm === taskName && task.job_cd === selectedJob && task.duty_nm === selectedDuty); 
                    if (taskIndex !== -1) { // 인덱스가 존재하면
                        jsonData[taskIndex]['work_lv_sum_adj'] = sum; // 업무수준 업데이트. json에 업데이트
                    }

                    // work_grade_adj 업데이트
                    const grade = getWorkGrade(sum); // 업무수준에 따른 업무등급을 가져옴
                    container.querySelector('input[name="work_grade_adj"]').value = grade;  // 업무등급 업데이트. 화면에만 업데이트
                    if (taskIndex !== -1) { // 인덱스가 존재하면
                        jsonData[taskIndex]['work_grade_adj'] = grade; // 업무등급 업데이트. json에 업데이트
                    }
                    // 업무등급에 따른 prfrm_tm_ann_cal_adj 업데이트
                    updatePrfrmTmAnnCalAdj(container, container.querySelector('input[name="prfrm_tm_ann_adj"]').value);
                }

                function getWorkGrade(sum) { // 업무수준에 따른 업무등급을 반환하는 함수
                for (const gradeData of jsonData2) { // gradeData는 standard.json의 각 요소이다.
                    if (sum >= gradeData.work_lv_min && sum <= gradeData.work_lv_max) { // 업무수준이 최소값과 최대값 사이에 있으면
                        return gradeData.work_grade; // 해당하는 업무등급 반환
                    }
                }
                return ''; // 기준에 맞는 등급이 없을 경우 빈 문자열 반환
                }

                function updatePrfrmTmAnnCalAdj(container, value) {
                if (validateInput2(value)) {
                    const taskName = container.querySelector('input[name="task_nm"]').value;
                    const taskIndex = jsonData.findIndex(task => task.task_nm === taskName && task.job_cd === selectedJob && task.duty_nm === selectedDuty);

                    if (taskIndex !== -1) {
                        jsonData[taskIndex]['prfrm_tm_ann_adj'] = value;
                    }

                    const workGradeAdj = container.querySelector('input[name="work_grade_adj"]').value;
                    const gradeData = jsonData2.find(data => data.work_grade === workGradeAdj);

                    if (gradeData) {
                        const prfrmTmAnnAdjValue = parseFloat(value);
                        const workloadWt = parseFloat(gradeData.workload_wt);

                        if (!isNaN(prfrmTmAnnAdjValue) && !isNaN(workloadWt)) {
                            const prfrmTmAnnCalAdj = prfrmTmAnnAdjValue * workloadWt;
                            container.querySelector('input[name="prfrm_tm_ann_cal_adj"]').value = prfrmTmAnnCalAdj.toFixed(1);

                            if (taskIndex !== -1) {
                                jsonData[taskIndex]['prfrm_tm_ann_cal_adj'] = prfrmTmAnnCalAdj.toFixed(1);
                            }

                        } else {
                            container.querySelector('input[name="prfrm_tm_ann_cal_adj"]').value = "NaN";
                            if (taskIndex !== -1) {
                                jsonData[taskIndex]['prfrm_tm_ann_cal_adj'] = "NaN";
                            }
                        }
                    }

                    // 각 값을 숫자로 변환
                    const imprtAdj = parseFloat(jsonData[taskIndex]['work_lv_imprt_adj']);
                    const imprt = parseFloat(jsonData[taskIndex]['work_lv_imprt']);
                    const dfcltAdj = parseFloat(jsonData[taskIndex]['work_lv_dfclt_adj']);
                    const dfclt = parseFloat(jsonData[taskIndex]['work_lv_dfclt']);
                    const prfcnAdj = parseFloat(jsonData[taskIndex]['work_lv_prfcn_adj']);
                    const prfcn = parseFloat(jsonData[taskIndex]['work_lv_prfcn']);
                    const prfrmAnnAdj = parseFloat(jsonData[taskIndex]['prfrm_tm_ann_adj']).toFixed(1);
                    const prfrmAnn = parseFloat(jsonData[taskIndex]['prfrm_tm_ann']).toFixed(1);

                    // 각 값들을 비교하여 adj_yn 설정
                    if (imprtAdj !== imprt || dfcltAdj !== dfclt || prfcnAdj !== prfcn || prfrmAnnAdj !== prfrmAnn) {
                        jsonData[taskIndex]['adj_yn'] = 1;
                        // input에 표시
                        container.querySelector('input[name="adj_yn"]').value = '*';
                    } else { // 같은 경우
                        jsonData[taskIndex]['adj_yn'] = 0;
                        container.querySelector('input[name="adj_yn"]').value = '';
                    }
                } else {
                    revertInput(container, 'prfrm_tm_ann_adj');
                }
                }

                function validateInput2(value) {
                if (/^\d+(\.\d{1})?$/.test(value)) { // 정수 또는 소숫점 첫째자리까지의 실수 허용
                    return true;
                } else {
                    alert("정수 또는 소숫점 첫째자리까지의 실수만 입력할 수 있습니다.");
                    return false;
                }
                }

                function validateInput(value) {
                if (/^[1-5]$/.test(value)) {
                    return true;
                } else {
                    alert("1부터 5까지의 정수만 입력할 수 있습니다.");
                    return false;
                }
                }

                function revertInput(container, inputName) {
                const previousValue = jsonData.find(task => task.task_nm === container.querySelector('input[name="task_nm"]').value)[inputName];
                container.querySelector(`input[name="${inputName}"]`).value = previousValue;
                }

                

            taskDiv.style.display = 'block'; // 과업 Div를 표시
            }

            // 계산 및 값을 표시하는 함수
            function calculateAndDisplayValue() {
                const stdWrkTm = parseFloat(document.querySelector('input[name="std_wrk_tm"]').value);
                let totalPrfrmTmAnnCalAdj = jsonData.reduce((sum, task) => {
                    let value = parseFloat(task.prfrm_tm_ann_cal_adj);
                    return sum + (isNaN(value) ? 0 : value);
                }, 0); // 초기값 0으로 설정
                
                const calculatedValue = bankersRound(totalPrfrmTmAnnCalAdj / stdWrkTm, 1).toFixed(1);
                const totalPrfrmTmAnnCalAdjRounded = bankersRound(totalPrfrmTmAnnCalAdj, 1).toFixed(1);
                
                document.getElementById('sum_prfrm_tm_ann_cal_adj').value = totalPrfrmTmAnnCalAdjRounded;
                document.getElementById('po_right_adj').value = calculatedValue;
            }

            function calculateDifferences() {
                // Get values from inputs
                var sum_prfrm_tm_ann_cal = parseFloat(document.getElementById('sum_prfrm_tm_ann_cal').value);
                var sum_prfrm_tm_ann_cal_adj = parseFloat(document.getElementById('sum_prfrm_tm_ann_cal_adj').value);
                var po_right = parseFloat(document.getElementById('po_right').value);
                var po_right_adj = parseFloat(document.getElementById('po_right_adj').value);

                // Calculate differences
                var prfrm_tm_diff = sum_prfrm_tm_ann_cal_adj - sum_prfrm_tm_ann_cal;
                var po_right_diff = po_right_adj - po_right;

                // Display differences in respective input fields
                document.getElementById('prfrm_tm_diff').value = prfrm_tm_diff.toFixed(1);
                document.getElementById('po_right_diff').value = po_right_diff.toFixed(1);
            }

            // Banker's rounding 함수 정의
            function bankersRound(num, decimalPlaces) {
                const factor = Math.pow(10, decimalPlaces);
                const n = num * factor;
                const f = Math.floor(n);
                const l = n - f;

                if (l > 0.5) {
                    return (f + 1) / factor;
                } else if (l < 0.5) {
                    return f / factor;
                } else {
                    // Exactly halfway
                    if (f % 2 === 0) {
                        return f / factor; // Round down if the floor is even
                    } else {
                        return (f + 1) / factor; // Round up if the floor is odd
                    }
                }
            }

            // function updateTaskList(selectedJob, selectedDuty) { // 과업 목록을 업데이트하는 함수

            //     // 선택된 직무와 책무에 해당하는 과업만 필터링하여 과업 순서대로 정렬하여 tasks에 저장
            //     var tasks = jsonData.filter(data => data.duty_nm === selectedDuty && data.job_cd === selectedJob).sort((a, b) => a.task_seq - b.task_seq);

            //     var taskDiv = document.getElementById('taskDiv'); // 과업 목록을 담을 div 요소 찾기

            //     taskDiv.innerHTML = ''; // 이전 내용을 지우고 제목을 다시 추가

            //     const tableContainer = document.createElement('div'); // 테이블 컨테이너 생성
            //     tableContainer.setAttribute('class', 'table-container'); // 테이블 컨테이너에 클래스 추가

            //     const table = document.createElement('table'); // 테이블 요소 생성
            //     table.setAttribute('class', 'task-table'); // 테이블에 클래스 추가

            //     const thead = document.createElement('thead');

            //     // 상위 헤더 행 추가
            //     const upperHeaderRow = document.createElement('tr');
            //     const thTaskName = document.createElement('th');
            //     thTaskName.setAttribute('rowspan', '2');
            //     thTaskName.textContent = '과업명';
            //     // 텍스트 가운데정렬
            //     thTaskName.style.textAlign = 'center';
            //     thTaskName.style.width = '10%';  // 과업명 열의 너비를 넓게 설정
            //     upperHeaderRow.appendChild(thTaskName);

            //     const thWorkVolume = document.createElement('th');
            //     thWorkVolume.setAttribute('colspan', '7');
            //     thWorkVolume.textContent = '업무량';
            //     // 텍스트 가운데정렬
            //     thWorkVolume.style.textAlign = 'center';
            //     thWorkVolume.classList.add('work-volume-header'); // 추가된 부분
            //     upperHeaderRow.appendChild(thWorkVolume);

            //     const thWorkVolumeAdj = document.createElement('th');
            //     thWorkVolumeAdj.setAttribute('colspan', '7');
            //     thWorkVolumeAdj.textContent = '업무량 조정';
            //     // 텍스트 가운데정렬
            //     thWorkVolumeAdj.style.textAlign = 'center';
            //     thWorkVolumeAdj.classList.add('work-volume-adj-header'); // 추가된 부분
            //     upperHeaderRow.appendChild(thWorkVolumeAdj);

            //     thead.appendChild(upperHeaderRow);

            //     // 하위 헤더 행 추가
            //     const headerRow = document.createElement('tr');
            //     const headers = ['중요도', '난이도', '숙련도', '업무수준', '업무등급', '연간 수행시간', '가중치 적용시간',
            //     '중요도', '난이도', '숙련도', '업무수준', '업무등급', '연간 수행시간', '가중치 적용시간'];
            //     headers.forEach((headerText, index) => {
            //         const th = document.createElement('th');
            //         th.textContent = headerText;
            //         if (index >= 1 && index <= 5) { // 중요도, 난이도, 숙련도, 업무수준, 업무등급, 연간 업무량 열의 너비를 넓게 설정
            //             th.style.width = 'auto';  // 나머지 열의 너비를 좁게 설정
            //         }
            //         headerRow.appendChild(th);
            //     });
            //     thead.appendChild(headerRow);

            //     table.appendChild(thead);

            //     // 테이블 본문 생성
            //     const tbody = document.createElement('tbody');
            //     tasks.forEach(taskData => {
            //         const row = document.createElement('tr');

            //         const cellValues = [
            //             { name: 'task_nm', value: taskData.task_nm, readonly: true },
            //             { name: 'work_lv_imprt', value: taskData.work_lv_imprt, readonly: true },
            //             { name: 'work_lv_dfclt', value: taskData.work_lv_dfclt, readonly: true },
            //             { name: 'work_lv_prfcn', value: taskData.work_lv_prfcn, readonly: true },
            //             { name: 'work_lv_sum', value: taskData.work_lv_sum, readonly: true },
            //             { name: 'work_grade', value: taskData.work_grade, readonly: true },
            //             { name: 'prfrm_tm_ann', value: parseFloat(taskData.prfrm_tm_ann).toFixed(1), readonly: true },
            //             { name: 'prfrm_tm_ann_cal', value: parseFloat(taskData.prfrm_tm_ann_cal).toFixed(1), readonly: true },
            //             { name: 'work_lv_imprt_adj', value: taskData.work_lv_imprt_adj, readonly: taskData.job_cd === 'JC001' },
            //             { name: 'work_lv_dfclt_adj', value: taskData.work_lv_dfclt_adj, readonly: taskData.job_cd === 'JC001' },
            //             { name: 'work_lv_prfcn_adj', value: taskData.work_lv_prfcn_adj, readonly: taskData.job_cd === 'JC001' },
            //             { name: 'work_lv_sum_adj', value: taskData.work_lv_sum_adj, readonly: true},
            //             { name: 'work_grade_adj', value: taskData.work_grade_adj, readonly: true },
            //             { name: 'prfrm_tm_ann_adj', value: parseFloat(taskData.prfrm_tm_ann_adj).toFixed(1)},
            //             { name: 'prfrm_tm_ann_cal_adj', value: parseFloat(taskData.prfrm_tm_ann_cal_adj).toFixed(1), readonly: true }
            //         ];

            //         cellValues.forEach(cell => {
            //             const td = document.createElement('td');
            //             const input = document.createElement('input');
            //             input.setAttribute('type', 'text');
            //             input.setAttribute('name', cell.name);
            //             input.setAttribute('value', cell.value);
            //             if (cell.readonly) {
            //                 input.setAttribute('readonly', 'readonly'); // 읽기 전용으로 설정
            //             }
            //             td.appendChild(input);
            //             row.appendChild(td);
                        
            //             // 각 input 필드에 대해 이벤트 리스너 추가
            //             if (cell.name === 'work_lv_imprt_adj') {
            //                 input.addEventListener('change', function() {
            //                     updateWorkLvImprtAdj(row, this.value);
            //                     updateWorkLvSumAndGradeAdj(row);
            //                     updatePrfrmTmAnnCalAdj(row, row.querySelector('input[name="prfrm_tm_ann_adj"]').value); // 추가된 부분
            //                 });
            //             } else if (cell.name === 'work_lv_dfclt_adj') {
            //                 input.addEventListener('change', function() {
            //                     updateWorkLvDfcltAdj(row, this.value);
            //                     updateWorkLvSumAndGradeAdj(row);
            //                     updatePrfrmTmAnnCalAdj(row, row.querySelector('input[name="prfrm_tm_ann_adj"]').value); // 추가된 부분
            //                 });
            //             } else if (cell.name === 'work_lv_prfcn_adj') {
            //                 input.addEventListener('change', function() {
            //                     updateWorkLvPrfcnAdj(row, this.value);
            //                     updateWorkLvSumAndGradeAdj(row);
            //                     updatePrfrmTmAnnCalAdj(row, row.querySelector('input[name="prfrm_tm_ann_adj"]').value); // 추가된 부분
            //                 });
            //             }

            //             if (cell.name === 'prfrm_tm_ann_adj') {
            //                 input.addEventListener('change', function() {
            //                     updatePrfrmTmAnnCalAdj(row, this.value); //this.value는 변경된 값
            //                 });
            //             }

            //         });

            //         tbody.appendChild(row);
            //     });

            //     // 함수 정의
            //     function updateWorkLvImprtAdj(row, value) {
            //         if (validateInput(value)) {
            //             const taskName = row.querySelector('input[name="task_nm"]').value;
            //             const taskIndex = jsonData.findIndex(task => task.task_nm === taskName && task.job_cd === selectedJob && task.duty_nm === selectedDuty);
                        
            //             if (taskIndex !== -1) {
            //                 jsonData[taskIndex]['work_lv_imprt_adj'] = value;
            //             }
            //         } else {
            //             revertInput(row, 'work_lv_imprt_adj');
            //         }
            //     }

            //     function updateWorkLvDfcltAdj(row, value) {
            //         if (validateInput(value)) {
            //             const taskName = row.querySelector('input[name="task_nm"]').value;
            //             const taskIndex = jsonData.findIndex(task => task.task_nm === taskName && task.job_cd === selectedJob && task.duty_nm === selectedDuty);
                        
            //             if (taskIndex !== -1) {
            //                 jsonData[taskIndex]['work_lv_dfclt_adj'] = value;
            //             }
            //         } else {
            //             revertInput(row, 'work_lv_dfclt_adj');
            //         }
            //     }

            //     function updateWorkLvPrfcnAdj(row, value) {
            //         if (validateInput(value)) {
            //             const taskName = row.querySelector('input[name="task_nm"]').value;
            //             const taskIndex = jsonData.findIndex(task => task.task_nm === taskName && task.job_cd === selectedJob && task.duty_nm === selectedDuty);
                        
            //             if (taskIndex !== -1) {
            //                 jsonData[taskIndex]['work_lv_prfcn_adj'] = value;
            //             }
            //         } else {
            //             revertInput(row, 'work_lv_prfcn_adj');
            //         }
            //     }

            //     function updateWorkLvSumAndGradeAdj(row) {
            //         const imprt = parseInt(row.querySelector('input[name="work_lv_imprt_adj"]').value, 10) || 0; // 중요도. 뒤의 10은 10진수를 의미
            //         const dfclt = parseInt(row.querySelector('input[name="work_lv_dfclt_adj"]').value, 10) || 0; // 난이도
            //         const prfcn = parseInt(row.querySelector('input[name="work_lv_prfcn_adj"]').value, 10) || 0; // 숙련도
            //         const sum = imprt + dfclt + prfcn;
                    
            //         row.querySelector('input[name="work_lv_sum_adj"]').value = sum; // 업무수준 업데이트. json이 아니라 화면에만 업데이트
                    
            //         const taskName = row.querySelector('input[name="task_nm"]').value; // 과업명을 받아옴
            //         // 그 직무의 그 책무의 그 과업의 인덱스를 찾음
            //         const taskIndex = jsonData.findIndex(task => task.task_nm === taskName && task.job_cd === selectedJob && task.duty_nm === selectedDuty); 
            //         if (taskIndex !== -1) { // 인덱스가 존재하면
            //             jsonData[taskIndex]['work_lv_sum_adj'] = sum; // 업무수준 업데이트. json에 업데이트
            //         }

            //         // work_grade_adj 업데이트
            //         const grade = getWorkGrade(sum); // 업무수준에 따른 업무등급을 가져옴
            //         row.querySelector('input[name="work_grade_adj"]').value = grade;  // 업무등급 업데이트. 화면에만 업데이트
            //         if (taskIndex !== -1) { // 인덱스가 존재하면
            //             jsonData[taskIndex]['work_grade_adj'] = grade; // 업무등급 업데이트. json에 업데이트
            //         }

            //         // 업무등급에 따른 prfrm_tm_ann_cal_adj 업데이트 추가된 부분
            //         updatePrfrmTmAnnCalAdj(row, row.querySelector('input[name="prfrm_tm_ann_adj"]').value);

            //     }

            //     function getWorkGrade(sum) { // 업무수준에 따른 업무등급을 반환하는 함수
            //         for (const gradeData of jsonData2) { // gradeData는 standard.json의 각 요소이다.
            //             if (sum >= gradeData.work_lv_min && sum <= gradeData.work_lv_max) { // 업무수준이 최소값과 최대값 사이에 있으면
            //                 return gradeData.work_grade; // 해당하는 업무등급 반환
            //             }
            //         }
            //         return ''; // 기준에 맞는 등급이 없을 경우 빈 문자열 반환
            //     }

            //     // 함수 정의
            //     function updatePrfrmTmAnnCalAdj(row, value) {
            //         if (validateInput2(value)) {
            //             const taskName = row.querySelector('input[name="task_nm"]').value;
            //             const taskIndex = jsonData.findIndex(task => task.task_nm === taskName && task.job_cd === selectedJob && task.duty_nm === selectedDuty);

            //             if (taskIndex !== -1) {
            //                 jsonData[taskIndex]['prfrm_tm_ann_adj'] = value;
            //             }

            //             const workGradeAdj = row.querySelector('input[name="work_grade_adj"]').value;
            //             const gradeData = jsonData2.find(data => data.work_grade === workGradeAdj);

            //             if (gradeData) {
            //                 const prfrmTmAnnAdjValue = parseFloat(value);
            //                 const workloadWt = parseFloat(gradeData.workload_wt);

            //                 if (!isNaN(prfrmTmAnnAdjValue) && !isNaN(workloadWt)) {
            //                     const prfrmTmAnnCalAdj = prfrmTmAnnAdjValue * workloadWt;
            //                     row.querySelector('input[name="prfrm_tm_ann_cal_adj"]').value = prfrmTmAnnCalAdj.toFixed(1);

            //                     if (taskIndex !== -1) {
            //                         jsonData[taskIndex]['prfrm_tm_ann_cal_adj'] = prfrmTmAnnCalAdj.toFixed(1);
            //                     }

            //                 } else {
            //                     row.querySelector('input[name="prfrm_tm_ann_cal_adj"]').value = "NaN";
            //                     if (taskIndex !== -1) {
            //                         jsonData[taskIndex]['prfrm_tm_ann_cal_adj'] = "NaN";
            //                     }
            //                 }
            //             }
            //         } else {
            //             revertInput(row, 'prfrm_tm_ann_adj');
            //         }
            //     }

            //     function validateInput2(value) {
            //         if (/^\d+(\.\d{1})?$/.test(value)) { // 정수 또는 소숫점 첫째자리까지의 실수 허용
            //             return true;
            //         } else {
            //             alert("정수 또는 소숫점 첫째자리까지의 실수만 입력할 수 있습니다.");
            //             return false;
            //         }
            //     }


            //     function validateInput(value) {
            //         if (/^[1-5]$/.test(value)) {
            //             return true;
            //         } else {
            //             alert("1부터 5까지의 정수만 입력할 수 있습니다.");
            //             return false;
            //         }
            //     }

            //     function revertInput(row, inputName) {
            //         const previousValue = jsonData.find(task => task.task_nm === row.querySelector('input[name="task_nm"]').value)[inputName];
            //         row.querySelector(`input[name="${inputName}"]`).value = previousValue;
            //     }

            //     table.appendChild(tbody);
            //     taskDiv.appendChild(table);

            //     taskDiv.style.display = 'block'; // 과업 Div를 표시
            // }

            document.getElementById('dataForm').onsubmit = function() { // 폼 제출 시 실행되는 함수. 서버로 데이터 전송 전에 실행됨. 
                // jsonData를 문자열로 변환하여 hidden input 필드에 설정
                document.getElementById('jsonData').value = JSON.stringify(jsonData);
                saveSelectionsToLocalStorage();
            };

            function saveSelectionsToLocalStorage() {
                var selectedJob = document.querySelector('input[name="job"]:checked').value;
                var selectedDuty = document.querySelector('input[name="duty"]:checked').value;
                localStorage.setItem('selectedJob', selectedJob);
                localStorage.setItem('selectedDuty', selectedDuty);
            }

            

            createJobList();
        });

        // 부서 변경 시 로컬 스토리지 삭제
        document.querySelector('select[name="dept_cd_selected"]').addEventListener('change', function() {
                localStorage.removeItem('selectedJob');
                localStorage.removeItem('selectedDuty');
            });

        // 회기 변경 시 로컬 스토리지 삭제
        document.querySelector('select[name="prd_selected"]').addEventListener('change', function() {
            localStorage.removeItem('selectedJob');
            localStorage.removeItem('selectedDuty');
        });

        // 로그아웃 시 로컬 스토리지 삭제
        document.getElementById('logoutLink').addEventListener('click', function() {
            localStorage.removeItem('selectedJob');
            localStorage.removeItem('selectedDuty');
        });
    </script>
</body>
{% endblock %}
